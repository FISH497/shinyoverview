---
title: "Shiny"
subtitle: "<br/>for the Quantifish group"
author: "Megsie Siple"
institute: "NOAA AFSC - RACE/GAP"
date: "2020/12/08 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

class: center, middle

# 1 - What is Shiny? 


---

# Data and code sharing

---

# The need

However, sometimes you want to make R code accessible outside of an R or RStudio environment. For example,

--

- teaching a package

--

- showing data visualizations to non-experts

--

- streamlining certain code-intensive things (like database queries or visualizing outputs from an analysis)

---

# Installing Shiny

Install **shiny**:

```{r eval=FALSE, tidy=FALSE}
install.packages("shiny")
```


---

class: center, middle

# Getting data into and out of Shiny


---


# Get data into a Shiny app

Shiny can accept data from various file types. 

You can get data into Shiny from:
- a file the user uploads
- a database
- a persistent file packaged with your app

---

# User uploads data
If you want to design your app so that people can bring in their own data:

Add a file upload input in the UI using the function `fileInput()`. In the `server` function, access the uploaded files via `input$mydata`:
```{r eval=FALSE}
ui <- fluidPage(
  # App title ----
  titlePanel("Uploading Files"),
  sidebarLayout(
    sidebarPanel(
      fileInput("mydata", "Choose CSV File",
                multiple = FALSE,
                accept = c("text/csv",
                         "text/comma-separated-values,text/plain",
                         ".csv")),
```

---

# Connect to a database

Shiny can access databases through the interface using the `{DBI}` and `{pool}` packages. 

```{r eval=FALSE}
library(shiny)
library(DBI)

ui <- fluidPage(
  numericInput("nrows", "Enter the number of rows to display:", 5),
  tableOutput("tbl")
)

server <- function(input, output, session) {
  output$tbl <- renderTable({
    conn <- dbConnect(
      drv = RMySQL::MySQL(),
      dbname = "shinydemo",
      host = "shiny-demo.csa7qlmguqrf.us-east-1.rds.amazonaws.com",
      username = "guest",
      password = "guest")
    on.exit(dbDisconnect(conn), add = TRUE)
    dbGetQuery(conn, paste0(
      "SELECT * FROM City LIMIT ", input$nrows, ";"))
  })
}

shinyApp(ui, server)
```

---

# File packaged with your app

You can publish small data files that sit on the server with your app. For example, if you want 

---

# Data in/out resources for Shiny

RStudio's [best practices for dashboards](https://db.rstudio.com/best-practices/dashboards/) shows how to connect to databases in Shiny

---

# Downloading from Shiny
You can download data from a Shiny app using `downloadLink()` in the ui and `downloadHandler()` in the server:

```{r eval=FALSE}
ui <- fluidPage(
  downloadLink("downloadData", "Download")
)

server <- function(input, output) {
  # Our dataset
  data <- mtcars

  output$downloadData <- downloadHandler(
    filename = function() {
      paste("data-", Sys.Date(), ".csv", sep="")
    },
    content = function(file) {
      write.csv(data, file)
    }
  )
}
```

---

# Downloading from Shiny

- Download CSV or txt files from Shiny apps

--

- Generate reports in Markdown that are knitted to html files (details on how to do that [here](https://shiny.rstudio.com/articles/generating-reports.html))

--

- You can also download images that have been generated in the app (e.g., download plots from the app)

---

# More resources for dealing with data in Shiny

Dean Attali's [Persistent Data Storage With Shiny](https://daattali.com/shiny/persistent-data-storage/) app 

[This](https://shiny.rstudio.com/articles/persistent-data-storage.html) blog post about data storage in Shiny (also by Dean Attali) 

---
# Using `learnr`
`{learnr}` uses `runtime: shiny_prerendered` to turn Markdown files into live tutorials. 

--

This is great for writing code in a 'controlled environment'
when you're:
- teaching coding concepts remotely
- demonstrating how a specific package is used
- any situation where you want to remotely set up the environment

---

# Getting started with `learnr`
```{r eval= FALSE}
install.packages("learnr")
library(learnr)
```

To make a new tutorial from the RStudio IDE, go to New File --> R Markdown --> From Template --> Interactive Tutorial {learnr}

---

# `learnr` tutorials - 1
A learnr tutorial is an .Rmd script a few additional features:

1. The output is a `learnr::tutorial`

2. The runtime (in yaml header) is `shiny_prerendered` 

3. There is some `learnr`-related setup code

4. There are `knitr` chunks which have custom options such as `exercise` and `solution`

 (from Nischal Shrestha's, great blog post [Learning learnr](https://education.rstudio.com/blog/2020/07/learning-learnr/) )
---

# `learnr` tutorials - 2
You load the packages that people will need for the tutorial in the `setup` code chunk. 

```{r eval=FALSE}
library(tidyverse)
library(palmerpenguins) #load any packages here that you want to be part of the environment for everyone using the tutorial
library(learnr)

knitr::opts_chunk$set(echo = FALSE)
```

---
# `learnr` tutorials - 3
The `exercise = TRUE` code chunks in a `learnr` document contain exercises, hints, and solutions.

![learnrchunks](img/learnr_chunks.png)
---

# More `learnr` resources

Allison Horst's [post about learnr](https://education.rstudio.com/blog/2020/05/learnr-for-remote/) on RStudio Education

Angela Li's [post on publishing learnr tutorials](https://cran.r-project.org/web/packages/learnr/vignettes/shinyapps-publishing.html)

Desir√©e de Leon's [post on putting learnr tutorials in a package](https://education.rstudio.com/blog/2020/09/delivering-learnr-tutorials-in-a-package/)

---
class: center, middle

# Demo: learnr basics



---

# Dynamic translation

The `{i18.shiny}` package contains functions for translating Shiny app components. 

---

# Publishing your Shiny app

If you've put a lot of time into making a Shiny app, you should get credit! 
The publication/credit avenues are unconventional for Shiny apps, but they DO exist.

- Publish in an open source software journal (e.g., JOSS)
- Publish code straight from GitHub with a DOI from Zenodo
- (for "just for fun" apps): submit your Shiny app to the RStudio [Shiny contest](https://community.rstudio.com/t/shiny-contest-2020-is-here/51002)
<!-- see if you can get some data on citation rates for JOSS vs zenodo github entry -->

---

# What if I am a NOAA employee?

If you are building a tool for NOAA purposes, you should:

1. Host it on your NOAA GitHub account if it's a NOAA project. If not, host on your personal account and fork a copy to the NOAA account if necessary
2. Ensure good software design practices, including having documentation related to the code as well as a separate users guide
3.Structure your R code and folders consistent with a accepted best practices
4. Get a code review (this should ideally be someone who also can review the content, if there is a model in your `server.R`)
5. Include testing (and examples if it makes sense-- if it's only a shiny app and not a whole package, it may not be needed). Use a package like `testthat`.  You can also use github actions to automate this in your repository

*Modified from Corinne Bassin's recommendations to me*

---

class: center, middle

# Fin!

**More Shiny resources:**
We love a [cheatsheet](https://shiny.rstudio.com/images/shiny-cheatsheet.pdf)



Slides created using the R package [**xaringan**](https://github.com/yihui/xaringan).
